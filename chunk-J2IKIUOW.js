import{a as k}from"./chunk-IWLDGLAP.js";import{a as l,m as f}from"./chunk-H2UEIIB4.js";import{$ as c,a,b as h,ea as s,k as u}from"./chunk-OF6GQXFW.js";var p=(()=>{class n{setCookie(t,i,e={}){let r=encodeURIComponent(t)+"="+encodeURIComponent(i);if(e.expires){if(typeof e.expires=="number"){let o=new Date;o.setTime(o.getTime()+e.expires*24*60*60*1e3),e.expires=o}r+=";expires="+e.expires.toUTCString()}e.path?r+=";path="+e.path:r+=";path=/",e.domain&&(r+=";domain="+e.domain),e.secure&&(r+=";secure"),e.sameSite?r+=";SameSite="+e.sameSite:r+=";SameSite=Lax",document.cookie=r}getCookie(t){let i=encodeURIComponent(t)+"=",e=document.cookie.split(";");for(let r=0;r<e.length;r++){let o=e[r];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(i)===0)return decodeURIComponent(o.substring(i.length,o.length))}return null}deleteCookie(t,i={}){let e=h(a({},i),{expires:new Date(0)});this.setCookie(t,"",e)}hasCookie(t){return this.getCookie(t)!==null}getAllCookies(){let t={},i=document.cookie.split(";");for(let e=0;e<i.length;e++){let r=i[e].trim();if(r){let o=r.split("=");if(o.length>=2){let d=decodeURIComponent(o[0]),v=decodeURIComponent(o.slice(1).join("="));t[d]=v}}}return t}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var S=(()=>{class n{constructor(t){this.cookieService=t,this.TOKEN_NAME="ng-tarmiz-auth-token"}getToken(){return this.cookieService.getCookie(this.TOKEN_NAME)}setToken(t){this.cookieService.setCookie(this.TOKEN_NAME,t,{expires:1,secure:!0,sameSite:"Strict"})}clearToken(){this.cookieService.deleteCookie(this.TOKEN_NAME)}static{this.\u0275fac=function(i){return new(i||n)(s(p))}}static{this.\u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var U=(()=>{class n{constructor(t,i,e,r){this.http=t,this.router=i,this.tokenService=e,this.userService=r,this.authSubject=new u(!1),this.isAuthenticated$=this.authSubject.asObservable(),this.checkAuthStatus()}login(t,i){return new Promise((e,r)=>{this.http.post("/account/login",{username:t,password:i}).subscribe({next:o=>{this.tokenService.setToken(o.token),this.authSubject.next(!0),this.validateToken(),e(!0)},error:o=>{console.error("Login error:",o),this.authSubject.next(!1),r(o)}})})}logout(){this.tokenService.clearToken(),this.userService.clearUser(),this.authSubject.next(!1),setTimeout(()=>this.router.navigate(["/login"]),0)}validateToken(){return new Promise(t=>{if(!this.tokenService.getToken())return t(!1);this.http.get("/account/info").subscribe({next:e=>{e?.accountId?(this.userService.setUser(e),t(!0)):t(!1)},error:e=>{console.warn("Token validation failed",e),t(!1)}})})}checkAuthStatus(){this.tokenService.getToken()&&this.validateToken().then(i=>{this.authSubject.next(i),i||(this.userService.clearUser(),this.logout())}).catch(()=>{this.authSubject.next(!1),this.userService.clearUser(),this.logout()})}static{this.\u0275fac=function(i){return new(i||n)(s(l),s(f),s(S),s(k))}}static{this.\u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{p as a,S as b,U as c};
