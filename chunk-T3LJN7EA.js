import{a as Q}from"./chunk-DDXT2S4Z.js";import{d as z,f as R,l as W,m as q,n as J,p as K}from"./chunk-XMS53VVL.js";import{Ca as U,Ea as $,I as M,J as L,L as N,M as V,N as B,Z as G,a as P,fa as j,ga as O,n as H,x as F,y as k}from"./chunk-H2UEIIB4.js";import{Cb as p,Ib as h,Kb as D,Lb as x,Mb as n,Nb as a,Ob as r,Xb as C,Zc as y,_b as S,a as f,b as g,cb as d,hb as b,hc as l,ic as E,lc as T,mc as A,nc as I,oc as w,pa as m,pb as v,vb as c}from"./chunk-OF6GQXFW.js";var X=(t,s)=>s.assetId;function Y(t,s){t&1&&(m(),r(0,"svg",19))}function Z(t,s){t&1&&(n(0,"a",20)(1,"div",21)(2,"span"),l(3,"View more"),a(),m(),r(4,"svg",22),a()())}function ee(t,s){t&1&&(m(),r(0,"svg",23))}function te(t,s){t&1&&(n(0,"a",20)(1,"div",21)(2,"span"),l(3,"View more"),a(),m(),r(4,"svg",22),a()())}function ie(t,s){t&1&&(m(),r(0,"svg",24))}function ae(t,s){t&1&&(n(0,"a",25)(1,"div",21)(2,"span"),l(3,"View more"),a(),m(),r(4,"svg",22),a()())}function ne(t,s){t&1&&(n(0,"option",11),l(1,"Loading..."),a())}function oe(t,s){if(t&1&&(n(0,"option",12),l(1),a()),t&2){let i=s.$implicit;S("value",i.assetId),d(),E(i.name)}}function se(t,s){t&1&&(n(0,"div",13),r(1,"c-spinner"),a())}function re(t,s){t&1&&(n(0,"div",13)(1,"p"),l(2,"No data for this asset"),a()())}function le(t,s){if(t&1&&r(0,"c-chart",14),t&2){let i=C();p("type",i.priceHistory.length===1?"bar":"line")("data",i.chartBarData)("options",i.options)("height",300)}}function de(t,s){t&1&&(n(0,"div",16),r(1,"c-spinner"),a())}function ce(t,s){t&1&&(n(0,"div",16)(1,"p"),l(2,"No data found"),a()())}function me(t,s){if(t&1&&r(0,"c-chart",17),t&2){let i=C();p("data",i.chartDoughnutData)("options",i.options)}}function pe(t,s){t&1&&(n(0,"div",16),r(1,"c-spinner"),a())}function he(t,s){t&1&&(n(0,"div",16)(1,"p"),l(2,"No data found"),a()())}function ue(t,s){if(t&1&&r(0,"c-chart",18),t&2){let i=C();p("data",i.chartPieData)("options",i.options)}}var Ae=(()=>{class t{constructor(i,o){this.http=i,this.datePipe=o,this.assetCount="...",this.assets=[],this.priceHistory=[],this.isLoading=!0,this.isLoadingPriceHistory=!0,this.options={maintainAspectRatio:!1},this.barChartOptions=g(f({},this.options),{normalized:!0}),this.userCount="...",this.totalAUM="...",this.chartBarData={labels:[],datasets:[]},this.chartPieData={labels:[],datasets:[]},this.chartDoughnutData={labels:[],datasets:[]},this.barChartEmpty=!1,this.pieChartEmpty=!1,this.doughnutChartEmpty=!1,this._selectedAssetId=""}get selectedAssetId(){return this._selectedAssetId}set selectedAssetId(i){i&&(this._selectedAssetId=i,this.fetchPriceHistory())}ngOnInit(){this.http.get("/issuer/assets/list").subscribe({next:({count:i,assets:o})=>{this.assetCount=i,this.assets=o,this.isLoading=!1,this.updateCharts(),this.selectedAssetId=`${this.assets[0]?.assetId}`||""},error:i=>{console.error("Failed to load assets:",i),this.assetCount=0,this.isLoading=!1}}),this.http.get("/issuer/asset/subscriptions").subscribe({next:({count:i,taum:o})=>{this.userCount=i,this.totalAUM=o},error:()=>{this.userCount=0,this.totalAUM=0}})}fetchPriceHistory(){this.isLoadingPriceHistory=!0;let i=this.selectedAssetId,o="818";if(!i){this.isLoadingPriceHistory=!1;return}this.http.get(`/asset/price/history/${i}/${o}`).subscribe({next:e=>{this.priceHistory=e.prices.map(u=>({time:this.datePipe.transform(u.time*1e3)??"",bid:u.bid,ask:u.ask})).reverse(),this.isLoadingPriceHistory=!1,this.updatePriceHistoryChart()},error:e=>{console.error("Failed to fetch price history:",e),this.isLoadingPriceHistory=!1}})}updatePriceHistoryChart(){let i=this.priceHistory.length===1?{backgroundColor:"#08D0DD"}:{borderColor:"#08D0DD",backgroundColor:"rgba(8, 208, 221, 0.2)"},o=this.priceHistory.length===1?{backgroundColor:"#FF5733"}:{borderColor:"#FF5733",backgroundColor:"rgba(255, 87, 51, 0.2)"};this.chartBarData={labels:this.priceHistory.map(e=>this.datePipe.transform(e.time)),datasets:[g(f({},i),{label:"Bid Price",data:this.priceHistory.map(e=>e.bid),fill:!0}),g(f({},o),{label:"Ask Price",data:this.priceHistory.map(e=>e.ask),fill:!0})]},this.barChartEmpty=[this.priceHistory.map(e=>e.bid),this.priceHistory.map(e=>e.ask)].every(e=>e.length===0)}updateCharts(){if(!this.assets.length)return;let i=new Map;this.assets.forEach(e=>{i.set(e.assetTypeName,(i.get(e.assetTypeName)||0)+1)}),this.chartPieData={labels:Array.from(i.keys()).map(e=>e||`Type ${e}`),datasets:[{data:Array.from(i.values()),backgroundColor:["#332EAE","#FF6384","#FFCE56","#4BC0C0"]}]},this.pieChartEmpty=Array.from(i.values()).every(e=>e===0);let o=new Map;this.assets.forEach(e=>{o.set(e.stateName,(o.get(e.stateName)||0)+1)}),this.chartDoughnutData={labels:Array.from(o.keys()).map(e=>e||`State ${e}`),datasets:[{data:Array.from(o.values()),backgroundColor:["#D622FF","#FF4500","#FFD700","#32CD32"]}]},this.doughnutChartEmpty=Array.from(o.values()).every(e=>e===0)}static{this.\u0275fac=function(o){return new(o||t)(b(P),b(y))}}static{this.\u0275cmp=v({type:t,selectors:[["app-dashboard"]],features:[w([y])],decls:44,vars:8,consts:[["md","12","xl","4"],["title","Total AUM","color","success","padding","",1,"mb-3",3,"value"],["cTemplateId","widgetIconTemplate"],["cTemplateId","widgetFooterTemplate"],["title","Asset count","color","primary","padding","",1,"mb-3",3,"value"],["title","Users Count","color","info","padding","",1,"mb-3",3,"value"],["lg","12"],[1,"mb-4"],[1,"d-flex","align-items-center","flex-wrap","gap-2"],[2,"margin-left","auto"],["cSelect","",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value"],[1,"d-flex","justify-content-center","align-items-center",2,"height","18.75rem"],[3,"type","data","options","height"],["xs","12","lg","6"],[1,"d-flex","justify-content-center","align-items-center",2,"height","16.75rem"],["type","doughnut",3,"data","options"],["type","pie",3,"data","options"],["cIcon","","name","cilChart","size","xl","width","24"],["routerLink","/assets/list",1,"font-weight-bold","font-xs","text-medium-emphasis"],[1,"d-flex","align-items-center","justify-content-between"],["cIcon","","name","cilArrowRight","width","16"],["cIcon","","name","cilChartPie","size","xl","width","24"],["cIcon","","name","cilGraph","size","xl","width","24"],["routerLink","/users",1,"font-weight-bold","font-xs","text-medium-emphasis"]],template:function(o,e){o&1&&(n(0,"c-row")(1,"c-col",0)(2,"c-widget-stat-f",1),c(3,Y,1,0,"ng-template",2)(4,Z,5,0,"ng-template",3),a()(),n(5,"c-col",0)(6,"c-widget-stat-f",4),c(7,ee,1,0,"ng-template",2)(8,te,5,0,"ng-template",3),a()(),n(9,"c-col",0)(10,"c-widget-stat-f",5),c(11,ie,1,0,"ng-template",2)(12,ae,5,0,"ng-template",3),a()(),n(13,"c-col",6)(14,"c-card",7)(15,"c-card-header",8)(16,"span"),l(17,"Price History"),a(),n(18,"c-card-header-actions",9)(19,"select",10),I("ngModelChange",function(_){return A(e.selectedAssetId,_)||(e.selectedAssetId=_),_}),c(20,ne,2,0,"option",11),D(21,oe,2,2,"option",12,X),a()()(),n(23,"c-card-body"),c(24,se,2,0,"div",13)(25,re,3,0,"div",13)(26,le,1,4,"c-chart",14),a()()()(),n(27,"c-row")(28,"c-col",15)(29,"c-card",7)(30,"c-card-header"),l(31," Asset State Distribution "),a(),n(32,"c-card-body"),c(33,de,2,0,"div",16)(34,ce,3,0,"div",16)(35,me,1,2,"c-chart",17),a()()(),n(36,"c-col",15)(37,"c-card",7)(38,"c-card-header"),l(39," Asset Type Breakdown "),a(),n(40,"c-card-body"),c(41,pe,2,0,"div",16)(42,he,3,0,"div",16)(43,ue,1,2,"c-chart",18),a()()()()),o&2&&(d(2),p("value",e.totalAUM),d(4),p("value",e.assetCount),d(4),p("value",e.userCount),d(9),T("ngModel",e.selectedAssetId),d(),h(e.isLoading?20:-1),d(),x(e.assets),d(3),h(e.isLoadingPriceHistory?24:e.barChartEmpty?25:26),d(9),h(e.isLoading?33:e.doughnutChartEmpty?34:35),d(8),h(e.isLoading?41:e.pieChartEmpty?42:43))},dependencies:[O,j,B,M,L,N,V,Q,U,G,K,q,J,W,z,R,$,k,F,H],encapsulation:2})}}return t})();export{Ae as DashboardComponent};
