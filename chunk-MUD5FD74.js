import{a as Q}from"./chunk-DDXT2S4Z.js";import{d as z,f as R,l as W,m as q,n as J,p as K}from"./chunk-XMS53VVL.js";import{Ca as U,Ea as $,I as k,J as L,L as V,M as B,N,Z as G,a as P,fa as j,ga as O,n as F,x as H,y as M}from"./chunk-H2UEIIB4.js";import{Cb as p,Ib as h,Kb as v,Lb as x,Mb as o,Nb as a,Ob as r,Xb as C,Zc as b,_b as S,a as g,b as f,cb as l,hb as y,hc as c,ic as T,lc as A,mc as I,nc as w,oc as E,pa as m,pb as D,vb as d}from"./chunk-OF6GQXFW.js";var X=(e,s)=>s.assetId;function Y(e,s){e&1&&(m(),r(0,"svg",19))}function Z(e,s){e&1&&(o(0,"a",20)(1,"div",21)(2,"span"),c(3,"View more"),a(),m(),r(4,"svg",22),a()())}function ee(e,s){e&1&&(m(),r(0,"svg",23))}function te(e,s){e&1&&(o(0,"a",20)(1,"div",21)(2,"span"),c(3,"View more"),a(),m(),r(4,"svg",22),a()())}function ie(e,s){e&1&&(m(),r(0,"svg",24))}function ae(e,s){e&1&&(o(0,"a",25)(1,"div",21)(2,"span"),c(3,"View more"),a(),m(),r(4,"svg",22),a()())}function ne(e,s){e&1&&(o(0,"option",11),c(1,"Loading..."),a())}function oe(e,s){if(e&1&&(o(0,"option",12),c(1),a()),e&2){let t=s.$implicit;S("value",t.assetId),l(),T(t.name)}}function se(e,s){e&1&&(o(0,"div",13),r(1,"c-spinner"),a())}function re(e,s){if(e&1&&r(0,"c-chart",14),e&2){let t=C();p("type",t.priceHistory.length===1?"bar":"line")("data",t.chartBarData)("options",t.options)("height",300)}}function le(e,s){e&1&&(o(0,"div",16),r(1,"c-spinner"),a())}function ce(e,s){if(e&1&&r(0,"c-chart",17),e&2){let t=C();p("data",t.chartDoughnutData)("options",t.options)}}function de(e,s){e&1&&(o(0,"div",16),r(1,"c-spinner"),a())}function me(e,s){if(e&1&&r(0,"c-chart",18),e&2){let t=C();p("data",t.chartPieData)("options",t.options)}}var Se=(()=>{class e{constructor(t,n){this.http=t,this.datePipe=n,this.assetCount="...",this.assets=[],this.priceHistory=[],this.isLoading=!0,this.isLoadingPriceHistory=!0,this.options={maintainAspectRatio:!1},this.barChartOptions=f(g({},this.options),{normalized:!0}),this.userCount="...",this.totalAUM="...",this.chartBarData={labels:[],datasets:[]},this.chartPieData={labels:[],datasets:[]},this.chartDoughnutData={labels:[],datasets:[]},this._selectedAssetId=""}get selectedAssetId(){return this._selectedAssetId}set selectedAssetId(t){t&&(this._selectedAssetId=t,this.fetchPriceHistory())}ngOnInit(){this.http.get("/asset/list").subscribe({next:({count:t,assets:n})=>{this.assetCount=t,this.assets=n,this.isLoading=!1,this.updateCharts(),this.selectedAssetId=`${this.assets[0]?.assetId}`||""},error:t=>{console.error("Failed to load assets:",t),this.assetCount=0,this.isLoading=!1}}),this.http.get("/issuer/asset/subscriptions").subscribe({next:({count:t,taum:n})=>{this.userCount=t,this.totalAUM=n},error:()=>{this.userCount=0,this.totalAUM=0}})}fetchPriceHistory(){this.isLoadingPriceHistory=!0;let t=this.selectedAssetId,n="818";if(!t){this.isLoadingPriceHistory=!1;return}this.http.get(`/asset/price/history/${t}/${n}`).subscribe({next:i=>{this.priceHistory=i.prices.map(u=>({time:this.datePipe.transform(u.time*1e3)??"",bid:u.bid,ask:u.ask})).reverse(),this.isLoadingPriceHistory=!1,this.updatePriceHistoryChart()},error:i=>{console.error("Failed to fetch price history:",i),this.isLoadingPriceHistory=!1}})}updatePriceHistoryChart(){let t=this.priceHistory.length===1?{backgroundColor:"#08D0DD"}:{borderColor:"#08D0DD",backgroundColor:"rgba(8, 208, 221, 0.2)"},n=this.priceHistory.length===1?{backgroundColor:"#FF5733"}:{borderColor:"#FF5733",backgroundColor:"rgba(255, 87, 51, 0.2)"};this.chartBarData={labels:this.priceHistory.map(i=>this.datePipe.transform(i.time)),datasets:[f(g({},t),{label:"Bid Price",data:this.priceHistory.map(i=>i.bid),fill:!0}),f(g({},n),{label:"Ask Price",data:this.priceHistory.map(i=>i.ask),fill:!0})]}}updateCharts(){if(!this.assets.length)return;let t=new Map;this.assets.forEach(i=>{t.set(i.assetTypeName,(t.get(i.assetTypeName)||0)+1)}),this.chartPieData={labels:Array.from(t.keys()).map(i=>i||`Type ${i}`),datasets:[{data:Array.from(t.values()),backgroundColor:["#332EAE","#FF6384","#FFCE56","#4BC0C0"]}]};let n=new Map;this.assets.forEach(i=>{n.set(i.stateName,(n.get(i.stateName)||0)+1)}),this.chartDoughnutData={labels:Array.from(n.keys()).map(i=>i||`State ${i}`),datasets:[{data:Array.from(n.values()),backgroundColor:["#D622FF","#FF4500","#FFD700","#32CD32"]}]}}static{this.\u0275fac=function(n){return new(n||e)(y(P),y(b))}}static{this.\u0275cmp=D({type:e,selectors:[["app-dashboard"]],features:[E([b])],decls:41,vars:8,consts:[["md","12","xl","4"],["title","Total AUM","color","success","padding","",1,"mb-3",3,"value"],["cTemplateId","widgetIconTemplate"],["cTemplateId","widgetFooterTemplate"],["title","Asset count","color","primary","padding","",1,"mb-3",3,"value"],["title","Users Count","color","info","padding","",1,"mb-3",3,"value"],["lg","12"],[1,"mb-4"],[1,"d-flex","align-items-center","flex-wrap","gap-2"],[2,"margin-left","auto"],["cSelect","",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value"],[1,"d-flex","justify-content-center","align-items-center",2,"height","18.75rem"],[3,"type","data","options","height"],["xs","12","lg","6"],[1,"d-flex","justify-content-center","align-items-center",2,"height","16.75rem"],["type","doughnut",3,"data","options"],["type","pie",3,"data","options"],["cIcon","","name","cilChart","size","xl","width","24"],["routerLink","/assets/list",1,"font-weight-bold","font-xs","text-medium-emphasis"],[1,"d-flex","align-items-center","justify-content-between"],["cIcon","","name","cilArrowRight","width","16"],["cIcon","","name","cilChartPie","size","xl","width","24"],["cIcon","","name","cilGraph","size","xl","width","24"],["routerLink","/users",1,"font-weight-bold","font-xs","text-medium-emphasis"]],template:function(n,i){n&1&&(o(0,"c-row")(1,"c-col",0)(2,"c-widget-stat-f",1),d(3,Y,1,0,"ng-template",2)(4,Z,5,0,"ng-template",3),a()(),o(5,"c-col",0)(6,"c-widget-stat-f",4),d(7,ee,1,0,"ng-template",2)(8,te,5,0,"ng-template",3),a()(),o(9,"c-col",0)(10,"c-widget-stat-f",5),d(11,ie,1,0,"ng-template",2)(12,ae,5,0,"ng-template",3),a()(),o(13,"c-col",6)(14,"c-card",7)(15,"c-card-header",8)(16,"span"),c(17,"Price History"),a(),o(18,"c-card-header-actions",9)(19,"select",10),w("ngModelChange",function(_){return I(i.selectedAssetId,_)||(i.selectedAssetId=_),_}),d(20,ne,2,0,"option",11),v(21,oe,2,2,"option",12,X),a()()(),o(23,"c-card-body"),d(24,se,2,0,"div",13)(25,re,1,4,"c-chart",14),a()()()(),o(26,"c-row")(27,"c-col",15)(28,"c-card",7)(29,"c-card-header"),c(30," Asset State Distribution "),a(),o(31,"c-card-body"),d(32,le,2,0,"div",16)(33,ce,1,2,"c-chart",17),a()()(),o(34,"c-col",15)(35,"c-card",7)(36,"c-card-header"),c(37," Asset Type Breakdown "),a(),o(38,"c-card-body"),d(39,de,2,0,"div",16)(40,me,1,2,"c-chart",18),a()()()()),n&2&&(l(2),p("value",i.totalAUM),l(4),p("value",i.assetCount),l(4),p("value",i.userCount),l(9),A("ngModel",i.selectedAssetId),l(),h(i.isLoading?20:-1),l(),x(i.assets),l(3),h(i.isLoadingPriceHistory?24:25),l(8),h(i.isLoading?32:33),l(7),h(i.isLoading?39:40))},dependencies:[O,j,N,k,L,V,B,Q,U,G,K,q,J,W,z,R,$,M,H,F],encapsulation:2})}}return e})();export{Se as DashboardComponent};
