import{Aa as O,Ba as R,G as k,H as A,J as M,L as $,a as F,da as V,ea as j,ra as z,sa as H,ta as N,y as B}from"./chunk-PQEJKUD4.js";import{$c as D,Cb as u,Ib as _,Jb as E,Kb as C,Lb as f,Mb as i,Nb as t,Ob as l,Sb as L,Vb as y,Xb as d,a as m,b as p,cb as c,hb as g,hc as r,ic as T,jc as h,na as x,oa as S,pb as v,pc as w,sc as I,uc as P,vb as b}from"./chunk-JYFIODHJ.js";var G=()=>[0,1,2,3,4],J=(e,a)=>a.subscriber;function K(e,a){e&1&&(i(0,"tr")(1,"td")(2,"p",7),l(3,"span",8),t()(),i(4,"td")(5,"p",7),l(6,"span",8),t()(),i(7,"td")(8,"p",7),l(9,"span",8),t()(),i(10,"td")(11,"p",7),l(12,"span",8),t()()())}function Q(e,a){e&1&&C(0,K,13,0,"tr",null,E),e&2&&f(w(0,G))}function U(e,a){e&1&&(i(0,"tr")(1,"td",9),r(2," No pending subscribers "),t()())}function W(e,a){e&1&&(l(0,"c-spinner",13),r(1," Loading... "))}function X(e,a){e&1&&r(0," Approve ")}function Y(e,a){if(e&1){let n=L();i(0,"tr")(1,"td",10),r(2),t(),i(3,"td",10),r(4),t(),i(5,"td",10),r(6),I(7,"number"),t(),i(8,"td")(9,"div",11)(10,"button",12),y("click",function(){let o=x(n).$implicit,q=d(2);return S(q.approveSubscriber({subscriber:o.subscriber,assetId:o.assetId}))}),b(11,W,2,0)(12,X,1,0),t()()()()}if(e&2){let n=a.$implicit,s=a.$index,o=d(2);c(2),T(s+1),c(2),h(" ",n.subscriber," "),c(2),h(" ",P(7,5,n.balance,"1.0-2")," "),c(4),u("disabled",o.submitting),c(),_(o.submitting?11:12)}}function Z(e,a){if(e&1&&C(0,Y,13,8,"tr",null,J),e&2){let n=d();f(n.subscribers)}}var se=(()=>{class e{constructor(n){this.http=n,this.isLoading=!0,this.subscribers=[],this.submitting=!1}ngOnInit(){this.fetchPendingSubscribers()}fetchPendingSubscribers(){this.http.get("/assets/subscribers/pending").subscribe(({subscribers:n})=>{this.subscribers=n.flatMap(s=>s.subscribers.map(o=>p(m({},o),{assetId:s.asset.assetId,contractAddress:s.contractAddress}))),this.isLoading=!1})}approveSubscriber(n){this.submitting=!0,this.http.post("/assets/subscription/set",p(m({},n),{state:2})).subscribe({next:()=>{this.fetchPendingSubscribers(),this.submitting=!1},error:()=>{this.submitting=!1}})}static{this.\u0275fac=function(s){return new(s||e)(g(F))}}static{this.\u0275cmp=v({type:e,selectors:[["app-subscribers-list"]],decls:25,vars:4,consts:[[1,"mb-4"],[2,"margin","0"],["xs",""],[1,"mb-0"],["cTable","",1,"mb-0","border",3,"hover","responsive","striped"],[1,"text-nowrap","text-truncate"],[1,"bg-body-tertiary"],["cPlaceholderAnimation","glow",2,"margin","0"],["cCol","12","cPlaceholder","",2,"border-radius","1rem","width","100%"],["colspan","4",1,"text-center",2,"padding-top","10rem","padding-bottom","10rem"],[2,"vertical-align","middle"],[1,"d-flex","align-items-center","justify-content-end"],["cButton","","size","sm",3,"click","disabled"],["size","sm"]],template:function(s,o){s&1&&(i(0,"c-row",0)(1,"c-col")(2,"h3",1),r(3,"Subscribers"),t()()(),i(4,"c-row")(5,"c-col",2)(6,"c-card",0)(7,"c-card-header")(8,"h5",3),r(9,"Subscriber List"),t()(),i(10,"c-card-body")(11,"table",4)(12,"thead",5)(13,"tr")(14,"th",6),r(15,"#"),t(),i(16,"th",6),r(17,"Subscriber"),t(),i(18,"th",6),r(19,"Balance"),t(),l(20,"th",6),t()(),i(21,"tbody"),b(22,Q,2,1)(23,U,3,0,"tr")(24,Z,2,0),t()()()()()()),s&2&&(c(11),u("hover",!0)("responsive",!0)("striped",!0),c(11),_(o.isLoading?22:!o.isLoading&&o.subscribers.length===0?23:24))},dependencies:[j,V,R,$,k,A,M,B,N,z,H,O,D],encapsulation:2})}}return e})();export{se as SubscribersListComponent};
