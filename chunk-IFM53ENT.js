import{a as q}from"./chunk-Z45COERD.js";import{d as j,f as $,l as W,m as R,n as z,p as V}from"./chunk-2SMDCKH4.js";import{G as E,H as T,J as k,K as M,L,X as w,a as I,da as B,ea as N,za as O}from"./chunk-AWGUPIYV.js";import{Cb as C,Ib as p,Kb as _,Lb as v,Mb as o,Nb as s,Ob as c,Xb as u,_b as x,_c as g,a as h,b as f,cb as r,hb as b,hc as d,ic as P,lc as S,mc as H,nc as A,oc as F,pb as D,vb as l}from"./chunk-JYFIODHJ.js";var G=(i,n)=>n.assetId;function J(i,n){i&1&&(o(0,"option",5),d(1,"Loading..."),s())}function K(i,n){if(i&1&&(o(0,"option",6),d(1),s()),i&2){let t=n.$implicit;x("value",t.assetId),r(),P(t.name)}}function Q(i,n){i&1&&(o(0,"div",7),c(1,"c-spinner"),s())}function U(i,n){if(i&1&&c(0,"c-chart",8),i&2){let t=u();C("type",t.priceHistory.length===1?"bar":"line")("data",t.chartBarData)("options",t.options)("height",300)}}function X(i,n){i&1&&(o(0,"div",10),c(1,"c-spinner"),s())}function Y(i,n){if(i&1&&c(0,"c-chart",11),i&2){let t=u();C("data",t.chartDoughnutData)("options",t.options)}}function Z(i,n){i&1&&(o(0,"div",10),c(1,"c-spinner"),s())}function tt(i,n){if(i&1&&c(0,"c-chart",12),i&2){let t=u();C("data",t.chartPieData)("options",t.options)}}var pt=(()=>{class i{constructor(t,a){this.http=t,this.datePipe=a,this.assets=[],this.priceHistory=[],this.isLoading=!0,this.isLoadingPriceHistory=!0,this.options={maintainAspectRatio:!1},this.barChartOptions=f(h({},this.options),{normalized:!0}),this.chartBarData={labels:[],datasets:[]},this.chartPieData={labels:[],datasets:[]},this.chartDoughnutData={labels:[],datasets:[]},this._selectedAssetId=""}get selectedAssetId(){return this._selectedAssetId}set selectedAssetId(t){t&&(this._selectedAssetId=t,this.fetchPriceHistory())}ngOnInit(){this.http.get("/assets/list").subscribe({next:({assets:t})=>{this.assets=t,this.isLoading=!1,this.updateCharts(),this.selectedAssetId=`${this.assets[0]?.assetId}`||""},error:t=>{console.error("Failed to load assets:",t),this.isLoading=!1}})}fetchPriceHistory(){this.isLoadingPriceHistory=!0;let t=this.selectedAssetId,a="818";if(!t){this.isLoadingPriceHistory=!1;return}this.http.get(`/assets/price/history/${t}/${a}`).subscribe({next:e=>{this.priceHistory=e.prices.map(m=>({time:this.datePipe.transform(m.time*1e3)??"",bid:m.bid,ask:m.ask})).reverse(),this.isLoadingPriceHistory=!1,this.updatePriceHistoryChart()},error:e=>{console.error("Failed to fetch price history:",e),this.isLoadingPriceHistory=!1}})}updatePriceHistoryChart(){let t=this.priceHistory.length===1?{backgroundColor:"#08D0DD"}:{borderColor:"#08D0DD",backgroundColor:"rgba(8, 208, 221, 0.2)"},a=this.priceHistory.length===1?{backgroundColor:"#FF5733"}:{borderColor:"#FF5733",backgroundColor:"rgba(255, 87, 51, 0.2)"};this.chartBarData={labels:this.priceHistory.map(e=>this.datePipe.transform(e.time)),datasets:[f(h({},t),{label:"Bid Price",data:this.priceHistory.map(e=>e.bid),fill:!0}),f(h({},a),{label:"Ask Price",data:this.priceHistory.map(e=>e.ask),fill:!0})]}}updateCharts(){if(!this.assets.length)return;let t=new Map;this.assets.forEach(e=>{t.set(e.assetTypeName,(t.get(e.assetTypeName)||0)+1)}),this.chartPieData={labels:Array.from(t.keys()).map(e=>e||`Type ${e}`),datasets:[{data:Array.from(t.values()),backgroundColor:["#332EAE","#FF6384","#FFCE56","#4BC0C0"]}]};let a=new Map;this.assets.forEach(e=>{a.set(e.stateName,(a.get(e.stateName)||0)+1)}),this.chartDoughnutData={labels:Array.from(a.keys()).map(e=>e||`State ${e}`),datasets:[{data:Array.from(a.values()),backgroundColor:["#D622FF","#FF4500","#FFD700","#32CD32"]}]}}static{this.\u0275fac=function(a){return new(a||i)(b(I),b(g))}}static{this.\u0275cmp=D({type:i,selectors:[["app-dashboard"]],features:[F([g])],decls:29,vars:5,consts:[["lg","12"],[1,"mb-4"],[1,"d-flex","align-items-center","flex-wrap","gap-2"],[2,"margin-left","auto"],["cSelect","",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value"],[1,"d-flex","justify-content-center","align-items-center",2,"height","18.75rem"],[3,"type","data","options","height"],["xs","12","lg","6"],[1,"d-flex","justify-content-center","align-items-center",2,"height","16.75rem"],["type","doughnut",3,"data","options"],["type","pie",3,"data","options"]],template:function(a,e){a&1&&(o(0,"c-row")(1,"c-col",0)(2,"c-card",1)(3,"c-card-header",2)(4,"span"),d(5,"Price History"),s(),o(6,"c-card-header-actions",3)(7,"select",4),A("ngModelChange",function(y){return H(e.selectedAssetId,y)||(e.selectedAssetId=y),y}),l(8,J,2,0,"option",5),_(9,K,2,2,"option",6,G),s()()(),o(11,"c-card-body"),l(12,Q,2,0,"div",7)(13,U,1,4,"c-chart",8),s()()()(),o(14,"c-row")(15,"c-col",9)(16,"c-card",1)(17,"c-card-header"),d(18," Asset State Distribution "),s(),o(19,"c-card-body"),l(20,X,2,0,"div",10)(21,Y,1,2,"c-chart",11),s()()(),o(22,"c-col",9)(23,"c-card",1)(24,"c-card-header"),d(25," Asset Type Breakdown "),s(),o(26,"c-card-body"),l(27,Z,2,0,"div",10)(28,tt,1,2,"c-chart",12),s()()()()),a&2&&(r(7),S("ngModel",e.selectedAssetId),r(),p(e.isLoading?8:-1),r(),v(e.assets),r(3),p(e.isLoadingPriceHistory?12:13),r(8),p(e.isLoading?20:21),r(7),p(e.isLoading?27:28))},dependencies:[N,B,L,E,T,k,M,q,O,w,V,R,z,W,j,$],encapsulation:2})}}return i})();export{pt as DashboardComponent};
